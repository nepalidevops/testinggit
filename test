CREATE STOGROUP SMS
 VOLUMES (*) 
 VCAT DBD1;

CREATE STOGROUP Storage_Group_2589
 VOLUMES (*) 
 VCAT DBD1;

CREATE STOGROUP Storage_Group_2616
 VOLUMES (*) 
 VCAT DBD1;

CREATE STOGROUP Storage_Group_2645
 VOLUMES (*) 
 VCAT DBD1;

CREATE STOGROUP Storage_Group_38977
 VOLUMES ('*') 
 VCAT DBD1;

CREATE DATABASE MTIMEA
 BUFFERPOOL BP1
 STOGROUP SMS;

CREATE TABLESPACE DY
 IN MTIMEA
 USING  STOGROUP SMS
 PRIQTY 528
 SECQTY 96
 FREEPAGE 0 PCTFREE 0
 BUFFERPOOL BP1
 CLOSE YES
 LOCKSIZE ANY
 SEGSIZE 64;

CREATE TABLESPACE MNTH
 IN MTIMEA
 USING  STOGROUP SMS
 PRIQTY 48
 SECQTY 48
 ERASE NO 
 FREEPAGE 0 PCTFREE 0
 DEFINE YES
 TRACKMOD YES
 BUFFERPOOL BP1
 CLOSE YES
 LOCKSIZE ANY
 SEGSIZE 64;

CREATE TABLESPACE WK
 IN MTIMEA
 USING  STOGROUP SMS
 PRIQTY 96
 SECQTY 48
 FREEPAGE 0 PCTFREE 0
 BUFFERPOOL BP1
 CLOSE YES
 LOCKSIZE ANY
 SEGSIZE 64;

CREATE TABLESPACE YR
 IN MTIMEA
 USING  STOGROUP SMS
 PRIQTY 48
 SECQTY 48
 FREEPAGE 0 PCTFREE 0
 BUFFERPOOL BP1
 CLOSE YES
 LOCKSIZE ANY
 SEGSIZE 64;

CREATE TABLE MTIMEA.DY
(
 YR_TYP               CHAR(2) NOT NULL,
 DAY_DT               DATE NOT NULL,
 YR                   CHAR(4) NOT NULL,
 CLNDR_YR             CHAR(4) NOT NULL,
 MNTH_ENDT            DATE NOT NULL,
 WK_ENDT              DATE NOT NULL,
 DAY_OF_WK_NM         CHAR(9) NOT NULL WITH DEFAULT,
 WRKG_DAY_CD          CHAR(1) NOT NULL WITH DEFAULT,
 VLD_SW               CHAR(1) NOT NULL WITH DEFAULT CONSTRAINT 
 Switch_320356248 CHECK (VLD_SW IN ('Y', 'N')),
 INSRT_TS             TIMESTAMP NOT NULL WITH DEFAULT,
 LU_TS                TIMESTAMP NOT NULL WITH DEFAULT,
 NON_WRKG_DAY_RSN_CD  VARCHAR(3)
);

LABEL ON COLUMN MTIMEA.DY.YR_TYP IS 'Year Type:';

LABEL ON COLUMN MTIMEA.DY.DAY_DT IS 'Day Date:';

LABEL ON COLUMN MTIMEA.DY.YR IS 'Year:';

LABEL ON COLUMN MTIMEA.DY.CLNDR_YR IS 'Calendar Year:';

LABEL ON COLUMN MTIMEA.DY.MNTH_ENDT IS 'Month End Date:';

LABEL ON COLUMN MTIMEA.DY.WK_ENDT IS 'Week End Date:';

LABEL ON COLUMN MTIMEA.DY.DAY_OF_WK_NM IS 'Day of Week Name:';

LABEL ON COLUMN MTIMEA.DY.WRKG_DAY_CD IS 'Working Day Switch:';

LABEL ON COLUMN MTIMEA.DY.VLD_SW IS 'Valid Switch:';

LABEL ON COLUMN MTIMEA.DY.INSRT_TS IS 'Insert Timestamp:';

LABEL ON COLUMN MTIMEA.DY.LU_TS IS 'Last Update Timestamp:';

LABEL ON COLUMN MTIMEA.DY.NON_WRKG_DAY_RSN_CD IS 'Non working Day Reason
 Code:';

CREATE UNIQUE INDEX MTIMEA.DYX1 ON MTIMEA.DY
(
 YR_TYP               ASC, 
 DAY_DT               ASC
) 
CLUSTER
  CLOSE YES;

ALTER TABLE MTIMEA.DY
 ADD CONSTRAINT DYX1  PRIMARY KEY (YR_TYP, DAY_DT);

CREATE TABLE MTIMEA.MNTH
(
 YR_TYP               CHAR(2) NOT NULL,
 YR                   CHAR(4) NOT NULL,
 MNTH_ENDT            DATE NOT NULL,
 CLNDR_YR             CHAR(4) NOT NULL,
 MNTH_NUM             CHAR(2) NOT NULL WITH DEFAULT,
 MNTH_NM              CHAR(9) NOT NULL WITH DEFAULT,
 MNTH_STDT            DATE NOT NULL WITH DEFAULT,
 WKS_IN_MNTH          CHAR(1) NOT NULL WITH DEFAULT,
 QTR_STDT             DATE NOT NULL WITH DEFAULT,
 QTR_ENDT             DATE NOT NULL WITH DEFAULT,
 QTR_NM               CHAR(20) NOT NULL WITH DEFAULT,
 QTR_NUM              CHAR(1) NOT NULL WITH DEFAULT,
 SEMI_ANNL_STDT       DATE NOT NULL WITH DEFAULT,
 SEMI_ANNL_ENDT       DATE NOT NULL WITH DEFAULT,
 SEMI_ANNL_PRD_NM     CHAR(20) NOT NULL WITH DEFAULT,
 SEMI_ANNL_PRD_NUM    CHAR(1) NOT NULL WITH DEFAULT,
 VLD_SW               CHAR(1) NOT NULL WITH DEFAULT CONSTRAINT 
 Switch_1617317767 CHECK (VLD_SW IN ('Y', 'N')),
 INSRT_TS             TIMESTAMP NOT NULL WITH DEFAULT,
 LU_TS                TIMESTAMP NOT NULL WITH DEFAULT
);

LABEL ON COLUMN MTIMEA.MNTH.YR_TYP IS 'Year Type:';

LABEL ON COLUMN MTIMEA.MNTH.YR IS 'Year:';

LABEL ON COLUMN MTIMEA.MNTH.MNTH_ENDT IS 'Month End Date:';

LABEL ON COLUMN MTIMEA.MNTH.CLNDR_YR IS 'Calendar Year:';

LABEL ON COLUMN MTIMEA.MNTH.MNTH_NUM IS 'Month Number:';

LABEL ON COLUMN MTIMEA.MNTH.MNTH_NM IS 'Month Name:';

LABEL ON COLUMN MTIMEA.MNTH.MNTH_STDT IS 'Month Start Date:';

LABEL ON COLUMN MTIMEA.MNTH.WKS_IN_MNTH IS 'Weeks In Month Count:';

LABEL ON COLUMN MTIMEA.MNTH.QTR_STDT IS 'Quarter Start Date:';

LABEL ON COLUMN MTIMEA.MNTH.QTR_ENDT IS 'Quarter End Date:';

LABEL ON COLUMN MTIMEA.MNTH.QTR_NM IS 'Quarter Name:';

LABEL ON COLUMN MTIMEA.MNTH.QTR_NUM IS 'Quarter Number:';

LABEL ON COLUMN MTIMEA.MNTH.SEMI_ANNL_STDT IS 'Semi Annual Start
 Date:';

LABEL ON COLUMN MTIMEA.MNTH.SEMI_ANNL_ENDT IS 'Semi Annual End Date:';

LABEL ON COLUMN MTIMEA.MNTH.SEMI_ANNL_PRD_NM IS 'Semi Annual Period
 Name:';

LABEL ON COLUMN MTIMEA.MNTH.SEMI_ANNL_PRD_NUM IS 'Semi Annual Period
 Number:';

LABEL ON COLUMN MTIMEA.MNTH.VLD_SW IS 'Valid Switch:';

LABEL ON COLUMN MTIMEA.MNTH.INSRT_TS IS 'Insert Timestamp:';

LABEL ON COLUMN MTIMEA.MNTH.LU_TS IS 'Last Update Timestamp:';

CREATE UNIQUE INDEX MTIMEA.MNTHX1 ON MTIMEA.MNTH
(
 YR_TYP               ASC, 
 YR                   ASC, 
 MNTH_ENDT            ASC
) 
CLUSTER
  CLOSE YES
  DEFER NO
  COPY NO;

ALTER TABLE MTIMEA.MNTH
 ADD CONSTRAINT MNTHX1  PRIMARY KEY (YR_TYP, YR, MNTH_ENDT);

CREATE TABLE NON_WRKG_DAY_RSN_REF
(
 NON_WRKG_DAY_RSN_CD  VARCHAR(3) NOT NULL,
 NON_WRKG_DAY_RSN_CDESC VARCHAR(254) NOT NULL,
 INSRT_TS             TIMESTAMP NOT NULL WITH DEFAULT,
 LU_TS                TIMESTAMP NOT NULL WITH DEFAULT,
 EFF_STDT             DATE NOT NULL,
 EFF_ENDT             DATE
);

LABEL ON COLUMN NON_WRKG_DAY_RSN_REF.NON_WRKG_DAY_RSN_CD IS 'Non working
 Day Reason Code:';

LABEL ON COLUMN NON_WRKG_DAY_RSN_REF.NON_WRKG_DAY_RSN_CDESC IS 'Non
 working Day Reason Code De';

LABEL ON COLUMN NON_WRKG_DAY_RSN_REF.INSRT_TS IS 'Insert Timestamp:';

LABEL ON COLUMN NON_WRKG_DAY_RSN_REF.LU_TS IS 'Last Update
 Timestamp:';

LABEL ON COLUMN NON_WRKG_DAY_RSN_REF.EFF_STDT IS 'Effective Start
 Date:';

LABEL ON COLUMN NON_WRKG_DAY_RSN_REF.EFF_ENDT IS 'Effective End
 Date:';

CREATE UNIQUE INDEX XPKNon_Working_Day_Reason_Reference ON
 NON_WRKG_DAY_RSN_REF
(
 NON_WRKG_DAY_RSN_CD  ASC
) 
NOT CLUSTER
  CLOSE YES;

ALTER TABLE NON_WRKG_DAY_RSN_REF
 ADD CONSTRAINT XPKNon_Working_Day_Reason_Reference  PRIMARY KEY
 (NON_WRKG_DAY_RSN_CD);

CREATE TABLE MTIMEA.WK
(
 YR_TYP               CHAR(2) NOT NULL,
 YR                   CHAR(4) NOT NULL,
 WK_ENDT              DATE NOT NULL,
 CLNDR_YR             CHAR(4) NOT NULL,
 MNTH_ENDT            DATE NOT NULL,
 WK_OF_YR_NUM         CHAR(2) NOT NULL WITH DEFAULT,
 WK_OF_MNTH_NUM       CHAR(1) NOT NULL WITH DEFAULT,
 WK_STDT              DATE NOT NULL WITH DEFAULT,
 WK_END_DAY_NM        CHAR(9) NOT NULL WITH DEFAULT,
 VLD_SW               CHAR(1) NOT NULL WITH DEFAULT CONSTRAINT 
 Switch_320361098 CHECK (VLD_SW IN ('Y', 'N')),
 INSRT_TS             TIMESTAMP NOT NULL WITH DEFAULT,
 LU_TS                TIMESTAMP NOT NULL WITH DEFAULT
);

LABEL ON COLUMN MTIMEA.WK.YR_TYP IS 'Year Type:';

LABEL ON COLUMN MTIMEA.WK.YR IS 'Year:';

LABEL ON COLUMN MTIMEA.WK.WK_ENDT IS 'Week End Date:';

LABEL ON COLUMN MTIMEA.WK.CLNDR_YR IS 'Calendar Year:';

LABEL ON COLUMN MTIMEA.WK.MNTH_ENDT IS 'Month End Date:';

LABEL ON COLUMN MTIMEA.WK.WK_OF_YR_NUM IS 'Week of Year Number:';

LABEL ON COLUMN MTIMEA.WK.WK_OF_MNTH_NUM IS 'Week of Month Number:';

LABEL ON COLUMN MTIMEA.WK.WK_STDT IS 'Week Start Date:';

LABEL ON COLUMN MTIMEA.WK.WK_END_DAY_NM IS 'Week End Day Name:';

LABEL ON COLUMN MTIMEA.WK.VLD_SW IS 'Valid Switch:';

LABEL ON COLUMN MTIMEA.WK.INSRT_TS IS 'Insert Timestamp:';

LABEL ON COLUMN MTIMEA.WK.LU_TS IS 'Last Update Timestamp:';

CREATE UNIQUE INDEX MTIMEA.WKX1 ON MTIMEA.WK
(
 YR_TYP               ASC, 
 YR                   ASC, 
 WK_ENDT              ASC
) 
CLUSTER
  CLOSE YES;

ALTER TABLE MTIMEA.WK
 ADD CONSTRAINT WKX1  PRIMARY KEY (YR_TYP, YR, WK_ENDT);

CREATE TABLE MTIMEA.YR
(
 YR_TYP               CHAR(2) NOT NULL,
 YR                   CHAR(4) NOT NULL,
 YR_TPDESC            CHAR(20) NOT NULL WITH DEFAULT,
 YR_STDT              DATE NOT NULL WITH DEFAULT,
 YR_ENDT              DATE NOT NULL WITH DEFAULT,
 VLD_SW               CHAR(1) NOT NULL WITH DEFAULT CONSTRAINT 
 Switch_320361617 CHECK (VLD_SW IN ('Y', 'N')),
 INSRT_TS             TIMESTAMP NOT NULL WITH DEFAULT,
 LU_TS                TIMESTAMP NOT NULL WITH DEFAULT
);

LABEL ON COLUMN MTIMEA.YR.YR_TYP IS 'Year Type:';

LABEL ON COLUMN MTIMEA.YR.YR IS 'Year:';

LABEL ON COLUMN MTIMEA.YR.YR_TPDESC IS 'Year Type Description:';

LABEL ON COLUMN MTIMEA.YR.YR_STDT IS 'Year Start Date:';

LABEL ON COLUMN MTIMEA.YR.YR_ENDT IS 'Year End Date:';

LABEL ON COLUMN MTIMEA.YR.VLD_SW IS 'Valid Switch:';

LABEL ON COLUMN MTIMEA.YR.INSRT_TS IS 'Insert Timestamp:';

LABEL ON COLUMN MTIMEA.YR.LU_TS IS 'Last Update Timestamp:';

CREATE UNIQUE INDEX MTIMEA.YRX1 ON MTIMEA.YR
(
 YR_TYP               ASC, 
 YR                   ASC
) 
CLUSTER
 USING  STOGROUP SMS
 PRIQTY 48
 SECQTY 48
 ERASE NO 
  FREEPAGE 0 PCTFREE 10
  DEFINE YES 
  BUFFERPOOL BP2
  CLOSE NO
  DEFER NO
  COPY NO;

ALTER TABLE MTIMEA.YR
 ADD CONSTRAINT YRX1  PRIMARY KEY (YR_TYP, YR);

ALTER TABLE MTIMEA.DY
 ADD CONSTRAINT R_2  FOREIGN KEY (NON_WRKG_DAY_RSN_CD)
  REFERENCES NON_WRKG_DAY_RSN_REF  (NON_WRKG_DAY_RSN_CD)
  ON DELETE RESTRICT;

CREATE TRIGGER MTIMEA.tI_DY AFTER INSERT ON DY
   REFERENCING NEW AS NEW FOR EACH ROW MODE DB2SQL
    UPDATE MTIMEA.DY
      SET
        MTIMEA.DY.NON_WRKG_DAY_RSN_CD = NULL
      WHERE
        NOT EXISTS (
          SELECT * FROM NON_WRKG_DAY_RSN_REF
            WHERE
              new.NON_WRKG_DAY_RSN_CD =
 NON_WRKG_DAY_RSN_REF.NON_WRKG_DAY_RSN_CD
        )
 !!

CREATE TRIGGER tD_NON_W AFTER DELETE ON NON_WRKG_DAY_RSN_REF
   REFERENCING OLD AS OLD FOR EACH ROW MODE DB2SQL
WHEN (0 < (SELECT count(*) FROM MTIMEA.DY WHERE
 MTIMEA.DY.NON_WRKG_DAY_RSN_CD = old.NON_WRKG_DAY_RSN_CD))
 BEGIN ATOMIC
     SIGNAL SQLSTATE '75001' ('Cannot delete NON_WRKG_DAY_RSN_REF
 because MTIMEA.DY exists.');
 END
 !!

